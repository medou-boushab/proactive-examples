<?xml version="1.0" encoding="UTF-8"?>
<job
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="urn:proactive:jobdescriptor:3.13" xsi:schemaLocation="urn:proactive:jobdescriptor:3.13 http://www.activeeon.com/public_content/schemas/proactive/jobdescriptor/3.13/schedulerjob.xsd"  name="IRIS_Deploy_Predict_Flower_Classifier_Model_Interactive" projectName="2. MaaS_ML Examples" priority="normal" onTaskError="continueJobExecution"  maxNumberOfExecution="2"  >
  <variables>
    <variable name="NATIVE_SCHEDULER" value=""  description="Name of the Native Scheduler node source to use when the workflow tasks must be deployed inside a cluster such as SLURM, LSF, etc." group="Resource Management" advanced="true" hidden="false"/>
    <variable name="NATIVE_SCHEDULER_PARAMS" value=""  description="Parameters given to the native scheduler (SLURM, LSF, etc) while requesting a ProActive node used to deploy the workflow tasks." group="Resource Management" advanced="true" hidden="false"/>
    <variable name="NODE_ACCESS_TOKEN" value=""  description="If not empty, the workflow tasks will be run only on nodes that contains the specified token." group="Resource Management" advanced="true" hidden="false"/>
    <variable name="CONTAINER_PLATFORM" value="docker" model="PA:LIST(no-container,docker,podman,singularity)" description="Specifies the container platform to be used for executing the workflow tasks." group="Container Parameters" advanced="true" hidden="false"/>
    <variable name="CONTAINER_GPU_ENABLED" value="False" model="PA:Boolean" description="If True, it will activate the use of GPU on the selected container platform." group="Container Parameters" advanced="true" hidden="false"/>
    <variable name="CONTAINER_IMAGE" value="" model="PA:LIST(,docker://activeeon/dlm3,docker://activeeon/cuda,docker://activeeon/cuda2,docker://activeeon/rapidsai,docker://activeeon/tensorflow:latest,docker://activeeon/tensorflow:latest-gpu)" description="Specifies the name of the container image that will be used to run the workflow tasks." group="Container Parameters" advanced="true" hidden="false"/>
    <variable name="MODEL_SERVICE_INSTANCE_NAME" value="maas_ml-${PA_JOB_ID}"  description="MaaS_ML Service instance name." group="MaaS_ML Service Configuration" advanced="true" hidden="false"/>
    <variable name="MODEL_SERVICE_PROXYFIED" value="True" model="PA:Boolean" description="Allows access to the endpoint through a HTTP(s) Proxy." group="MaaS_ML Service Configuration" advanced="true" hidden="false"/>
    <variable name="MODEL_SERVICE_ENTRYPOINT" value="ml_service"  description="This entry script starts the service and defines the different functions to deploy the model, scores the prediction requests based on the deployed model, and returns the results." group="MaaS_ML Service Configuration" advanced="true" hidden="false"/>
    <variable name="MODEL_SERVICE_YAML_FILE" value="ml_service-api"  description="A YAML file that describes the OpenAPI Specification ver. 2 (known as Swagger Spec) of the service." group="MaaS_ML Service Configuration" advanced="true" hidden="false"/>
    <variable name="MODEL_SERVICE_USER_NAME" value="user"  description="A valid user name having the needed privileges to execute this action."  advanced="false" hidden="false"/>
    <variable name="MODEL_SERVICE_NODE_NAME" value=""  description="The name of the node where the service will be deployed. If empty, the service will be deployed on an available node selected randomly." group="MaaS_ML Service Configuration" advanced="true" hidden="false"/>
    <variable name="SERVICE_TOKEN" value=""  description="A valid token generated by the MaaS_ML Service for user authentication."  advanced="false" hidden="false"/>
    <variable name="USE_NVIDIA_RAPIDS" value="False" model="PA:Boolean" description="If True, the service will be configured to use the GPU and the Nvidia Rapids library."  advanced="false" hidden="false"/>
    <variable name="WORK_DIR" value="."  description="Defines the working directory for the data space used to transfer files automatically between the workflow tasks."  advanced="false" hidden="true"/>
  </variables>
  <description>
    <![CDATA[ Train an Iris Flower Classifier, deploy it in a service and call the prediction endpoint to do the predictions. ]]>
  </description>
  <genericInformation>
    <info name="bucketName" value="model-as-a-service"/>
    <info name="workflow.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/model_as_service.png"/>
    <info name="NS" value="$NATIVE_SCHEDULER"/>
    <info name="Documentation" value="PML/PMLUserGuide.html#_deployment_pipeline_examples"/>
    <info name="NODE_ACCESS_TOKEN" value="$NODE_ACCESS_TOKEN"/>
    <info name="NS_BATCH" value="$NATIVE_SCHEDULER_PARAMS"/>
    <info name="group" value="public-objects"/>
  </genericInformation>
  <taskFlow>
    <task name="Split_Data" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Separate data into training and testing sets. ]]>
      </description>
      <variables>
        <variable name="TRAIN_SIZE" value="0.7" inherited="false"     />
        <variable name="TASK_ENABLED" value="True" inherited="false" model="PA:Boolean"    />
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/data-processing.png"/>
        <info name="task.documentation" value="PML/PMLUserGuide.html#_split_data"/>
      </genericInformation>
      <depends>
        <task ref="Load_Iris_Dataset"/>
      </depends>
      <forkEnvironment javaHome="/usr" >
        <envScript>
          <script>
            <file url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_ai/raw" language="groovy"></file>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/machine-learning/resources/Split_Data_Script/raw" language="cpython"></file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"></controlFlow>
      <metadata>
        <positionTop>
            227.96875
        </positionTop>
        <positionLeft>
            216.5
        </positionLeft>
      </metadata>
    </task>
    <task name="Train_Model" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Train a classification/clustering/anomaly detection model ]]>
      </description>
      <variables>
        <variable name="TASK_ENABLED" value="True" inherited="false"     />
        <variable name="LABEL_COLUMN" value="species" inherited="false"     />
        <variable name="N_SPLITS" value="5" inherited="false" model="PA:Integer"    />
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/train.png"/>
        <info name="task.documentation" value="PML/PMLUserGuide.html#_train_model"/>
      </genericInformation>
      <depends>
        <task ref="Split_Data"/>
        <task ref="Support_Vector_Machines"/>
      </depends>
      <forkEnvironment javaHome="/usr" >
        <envScript>
          <script>
            <file url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_ai/raw" language="groovy"></file>
          </script>
        </envScript>
      </forkEnvironment>
      <pre>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/auto-ml-optimization/resources/get_automl_token/raw" language="groovy"></file>
        </script>
      </pre>
      <scriptExecutable>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/machine-learning/resources/Train_Model_Script/raw" language="cpython"></file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"></controlFlow>
      <metadata>
        <positionTop>
            355.96875
        </positionTop>
        <positionLeft>
            118
        </positionLeft>
      </metadata>
    </task>
    <task name="Support_Vector_Machines" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Support Vector Machines are supervised learning models with associated learning algorithms that analyze data used for classification. ]]>
      </description>
      <variables>
        <variable name="TASK_ENABLED" value="True" inherited="false" model="PA:Boolean"    />
        <variable name="INPUT_VARIABLES" value="{&quot;probability&quot;: true}" inherited="false"     />
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/ml_classification.png"/>
        <info name="task.documentation" value="PML/PMLUserGuide.html#_support_vector_machines"/>
      </genericInformation>
      <forkEnvironment javaHome="/usr" >
        <envScript>
          <script>
            <file url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_ai/raw" language="groovy"></file>
          </script>
        </envScript>
      </forkEnvironment>
      <pre>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/auto-ml-optimization/resources/get_automl_params/raw" language="groovy"></file>
        </script>
      </pre>
      <scriptExecutable>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/machine-learning/resources/Support_Vector_Machine_Script/raw" language="cpython"></file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"></controlFlow>
      <metadata>
        <positionTop>
            227.96875
        </positionTop>
        <positionLeft>
            384
        </positionLeft>
      </metadata>
    </task>
    <task name="Load_Iris_Dataset" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Load and return the iris dataset classification. ]]>
      </description>
      <variables>
        <variable name="TASK_ENABLED" value="True" inherited="false" model="PA:Boolean"    />
        <variable name="IMPORT_FROM" value="PA:URL" inherited="false" model="PA:LIST(PA:URL,PA:URI,PA:USER_FILE,PA:GLOBAL_FILE)"    />
        <variable name="FILE_PATH" value="https://s3.eu-west-2.amazonaws.com/activeeon-public/datasets/iris.csv" inherited="false" model="$IMPORT_FROM"    />
        <variable name="FILE_DELIMITER" value="," inherited="false"     />
        <variable name="LIMIT_OUTPUT_VIEW" value="100" inherited="false" model="PA:Integer"    />
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/load_dataset.png"/>
        <info name="task.documentation" value="PML/PMLUserGuide.html#_load_iris_dataset"/>
      </genericInformation>
      <forkEnvironment javaHome="/usr" >
        <envScript>
          <script>
            <file url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_ai/raw" language="groovy"></file>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/machine-learning/resources/Load_Iris_Dataset_Script/raw" language="cpython"></file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"></controlFlow>
      <metadata>
        <positionTop>
            99.96875
        </positionTop>
        <positionLeft>
            216.5
        </positionLeft>
      </metadata>
    </task>
    <task name="MaaS_ML_Actions" 
    
    onTaskError="cancelJob" 
    
    
    fork="true">
      <description>
        <![CDATA[ Manage the life-cycle of MaaS_ML PSA. This workflow trigger three possible actions: Pause_MaaS_ML, Resume_MaaS_ML and Finish_MaaS_ML. ]]>
      </description>
      <variables>
        <variable name="ACTION" value="Finish_MaaS_ML" inherited="false" model="PA:LIST(Pause_MaaS_ML, Resume_MaaS_ML, Finish_MaaS_ML)"    />
        <variable name="INSTANCE_NAME" value="maas_ml-${PA_JOB_ID}" inherited="true"     />
        <variable name="INSTANCE_ID" value="" inherited="false"     />
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/model_as_service.png"/>
        <info name="task.documentation" value="PML/PMLUserGuide.html#_delete_finish_the_service"/>
      </genericInformation>
      <depends>
        <task ref="Loop"/>
      </depends>
      <scriptExecutable>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Action/raw" language="groovy"></file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"></controlFlow>
      <metadata>
        <positionTop>
            1251.96875
        </positionTop>
        <positionLeft>
            216.5
        </positionLeft>
      </metadata>
    </task>
    <task name="Wait_for_Signal" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ A template task that sends a ready notification for all the signals specified in the variable SIGNALS, then loops until one signal among those specified is received by the job. ]]>
      </description>
      <variables>
        <variable name="SIGNALS" value="Terminate_Job_and_Service,Make_New_Prediction" inherited="false"    advanced="false" hidden="false"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/signal-wait.png"/>
        <info name="TASK.DOCUMENTATION" value="user/ProActiveUserGuide.html#_task_signal_api"/>
      </genericInformation>
      <depends>
        <task ref="MaaS_ML_Call_Prediction"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import com.google.common.base.Splitter;

public static boolean containsIgnoreCase(String str, String searchStr) {
    if(str == null || searchStr == null) return false;
    final int length = searchStr.length();
    if (length == 0)
        return true;
    for (int i = str.length() - length; i >= 0; i--) {
        if (str.regionMatches(true, i, searchStr, 0, length))
            return true;
    }
    return false;
}

if (variables.get("PA_TASK_ITERATION_SIGNAL")==null){
	variables.put("PA_TASK_ITERATION_SIGNAL",0)
}
if (variables.get("PA_TASK_ITERATION_SIGNAL")==0){
    
    // Read the variable SIGNALS
	signals = variables.get("SIGNALS")

	// Split the value of the variable SIGNALS and transform it into a list
	Set signalsSet = new HashSet<>(Splitter.on(',').trimResults().omitEmptyStrings().splitToList(signals))
    
    // Send a ready notification for each signal in the set
    println("Ready for signals "+ signalsSet)
    signalsSet.each { 
        signal -> signalapi.readyForSignal(signal)
    }
    
    // Add the signals set as a variable to be used by next tasks
    variables.put("SIGNALS_SET", signalsSet)
}
variables.put("PA_TASK_ITERATION_SIGNAL",variables.get("PA_TASK_ITERATION_SIGNAL")+1)

//Read the variable SIGNALS_SET
Set signalsSet =  variables.get("SIGNALS_SET")

// Check whether one signal among those specified as input is received
println("Checking whether one signal in the set "+ signalsSet +" is received")
receivedSignals = signalapi.checkForSignals(signalsSet)

// If a signal is received, remove ready signals and break the loop, else sleep 10 seconds then restart
if (receivedSignals != null && !receivedSignals.isEmpty()) {    
    // remove ready signals
	signalapi.removeManySignals(new HashSet<>(signalsSet.collect { signal -> "ready_"+signal }))    

    // Print the received signal
    println("Received signals: " + receivedSignals.toString())
    terminate = false
    for (String s : Arrays.asList(receivedSignals.keySet())) {
        if (containsIgnoreCase(s, "Make_New_Prediction") && !terminate) {
            result = "Make_New_Prediction"
        }
        else if (containsIgnoreCase(s, "Terminate_Job_and_Service")) {
            result = "Terminate_Job_and_Service"
            terminate = true
        }
    }
    
} else {
    result = null    
}
variables.put("RECEIVED_SIGNAL", result)
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow >
        <loop target="Wait_for_Signal">
          <script>
            <code language="groovy">
              <![CDATA[
if (result!=null){
    loop = false
} else {
    loop = "* * * * *"
}
]]>
            </code>
          </script>
        </loop>
      </controlFlow>
      <metadata>
        <positionTop>
            995.96875
        </positionTop>
        <positionLeft>
            216.5
        </positionLeft>
      </metadata>
    </task>
    <task name="MaaS_ML_Service_Start" 
    
    onTaskError="cancelJob" 
    
    
    fork="true">
      <description>
        <![CDATA[ Start a model server to deploy ML models. ]]>
      </description>
      <variables>
        <variable name="SERVICE_ID" value="MaaS_ML" inherited="false"     />
        <variable name="INSTANCE_NAME" value="$MODEL_SERVICE_INSTANCE_NAME" inherited="false"     />
        <variable name="ENGINE" value="$CONTAINER_PLATFORM" inherited="false"     />
        <variable name="PROXYFIED" value="$MODEL_SERVICE_PROXYFIED" inherited="false"     />
        <variable name="PYTHON_ENTRYPOINT" value="$MODEL_SERVICE_ENTRYPOINT" inherited="false"     />
        <variable name="YAML_FILE" value="$MODEL_SERVICE_YAML_FILE" inherited="false"     />
        <variable name="USER_NAME" value="$MODEL_SERVICE_USER_NAME" inherited="false"     />
        <variable name="NODE_NAME" value="$MODEL_SERVICE_NODE_NAME" inherited="false"     />
        <variable name="NATIVE_SCHEDULER" value="" inherited="true"     />
        <variable name="NATIVE_SCHEDULER_PARAMS" value="" inherited="true"     />
        <variable name="GPU_ENABLED" value="$USE_NVIDIA_RAPIDS" inherited="false"     />
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/model_as_service.png"/>
        <info name="task.documentation" value="PML/PMLUserGuide.html#_start_a_generic_service_instance"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Start/raw" language="groovy">
            <arguments>
              <argument value="true"/>
              <argument value="NATIVE_SCHEDULER"/>
              <argument value="NATIVE_SCHEDULER_PARAMS"/>
              <argument value="ENGINE"/>
              <argument value="PROXYFIED"/>
              <argument value="PYTHON_ENTRYPOINT"/>
              <argument value="YAML_FILE"/>
              <argument value="NODE_NAME"/>
              <argument value="GPU_ENABLED"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"></controlFlow>
      <post>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/model-as-a-service/resources/MaaS_Start_Post_Script/raw" language="cpython"></file>
        </script>
      </post>
      <metadata>
        <positionTop>
            355.96875
        </positionTop>
        <positionLeft>
            246
        </positionLeft>
      </metadata>
    </task>
    <task name="MaaS_ML_Deploy_Model" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Deploy a ML model. ]]>
      </description>
      <variables>
        <variable name="DEPLOY_MODEL_ENDPOINT" value="" inherited="false"     />
        <variable name="API_EXTENSION" value="/api/deploy" inherited="false"     />
        <variable name="MODEL_URL" value="https://activeeon-public.s3.eu-west-2.amazonaws.com/models" inherited="false"     />
        <variable name="SERVICE_TOKEN" value="" inherited="true"     />
        <variable name="DRIFT_DETECTION_WINDOW_SIZE" value="50" inherited="true"     />
        <variable name="LOG_PREDICTIONS" value="true" inherited="false" model="PA:Boolean"    />
        <variable name="MODEL_NAME" value="iris_flowers_classifier" inherited="false"     />
        <variable name="MODEL_VERSION" value="1" inherited="false" model="PA:Integer"    />
        <variable name="BASELINE_DATA_URL" value="" inherited="false"     />
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/model_as_service.png"/>
        <info name="task.documentation" value="PML/PMLUserGuide.html#_deploy_a_specific_ml_model"/>
      </genericInformation>
      <depends>
        <task ref="MaaS_ML_Service_Start"/>
        <task ref="Train_Model"/>
      </depends>
      <forkEnvironment javaHome="/usr" >
        <envScript>
          <script>
            <file url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_ai/raw" language="groovy"></file>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/model-as-a-service/resources/MaaS_ML_Deploy_Model_Script/raw" language="cpython"></file>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            483.96875
        </positionTop>
        <positionLeft>
            182
        </positionLeft>
      </metadata>
    </task>
    <task name="MaaS_ML_Call_Prediction" 
    
    
    
    preciousResult="true" 
    fork="true">
      <description>
        <![CDATA[ Call the launched service to predict results based on the last deployed model. ]]>
      </description>
      <variables>
        <variable name="PREDICT_MODEL_ENDPOINT" value="" inherited="false"     />
        <variable name="SERVICE_TOKEN" value="" inherited="true"     />
        <variable name="PREDICT_EXTENSION" value="/api/predict" inherited="false"     />
        <variable name="INPUT_DATA" value="" inherited="false"     />
        <variable name="LABEL_COLUMN" value="species" inherited="false"     />
        <variable name="DATA_DRIFT_DETECTOR" value="HDDM" inherited="true" model="PA:LIST(HDDM,Page Hinkley, ADWIN)"    />
        <variable name="MODEL_NAME" value="iris_flowers_classifier" inherited="false"     />
        <variable name="MODEL_VERSION" value="1" inherited="false" model="PA:Integer"    />
        <variable name="SAVE_PREDICTIONS" value="True" inherited="false" model="PA:Boolean"   advanced="false" hidden="false"/>
        <variable name="DRIFT_ENABLED" value="True" inherited="false" model="PA:Boolean"    />
        <variable name="DRIFT_NOTIFICATION" value="False" inherited="false" model="PA:Boolean"    />
        <variable name="LIMIT_OUTPUT_VIEW" value="-1" inherited="false"    advanced="false" hidden="false"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/model_as_service.png"/>
        <info name="task.documentation" value="PML/PMLUserGuide.html#_call_the_service_for_predicition"/>
      </genericInformation>
      <depends>
        <task ref="Start"/>
      </depends>
      <forkEnvironment javaHome="/usr" >
        <envScript>
          <script>
            <file url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_ai/raw" language="groovy"></file>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/model-as-a-service/resources/MaaS_ML_Call_Prediction_Script/raw" language="cpython"></file>
        </script>
      </scriptExecutable>
      <post>
        <script>
          <code language="cpython">
            <![CDATA[

]]>
          </code>
        </script>
      </post>
      <metadata>
        <positionTop>
            867.96875
        </positionTop>
        <positionLeft>
            216.5
        </positionLeft>
      </metadata>
    </task>
    <task name="Start" 
    
    
    
    
    fork="true">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_loop.png"/>
        <info name="Documentation" value="user/ProActiveUserGuide.html#_loop"/>
      </genericInformation>
      <depends>
        <task ref="Get_Parameters"/>
      </depends>
      <forkEnvironment javaHome="/usr" >
        <envScript>
          <script>
            <file url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_ai/raw" language="groovy"></file>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <code language="cpython">
            <![CDATA[
import urllib.request
import ssl
import pandas as pd

global variables

# -------------------------------------------------------------
# Import an external python script containing a collection of
# common utility Python functions and classes
#PA_CATALOG_REST_URL = variables.get("PA_CATALOG_REST_URL")
#PA_PYTHON_UTILS_URL = PA_CATALOG_REST_URL + "/buckets/machine-learning/resources/Utils_Script/raw"
#if PA_PYTHON_UTILS_URL.startswith('https'):
#    exec(urllib.request.urlopen(PA_PYTHON_UTILS_URL, context=ssl._create_unverified_context()).read(), globals())
#else:
#    exec(urllib.request.urlopen(PA_PYTHON_UTILS_URL).read(), globals())
#global get_input_variables
#global raiser_ex
# -------------------------------------------------------------

input_variables = {
    'task.dataframe_id_test': None,
    'task.dataframe_id': None,
    'task.label_column': None,
    'task.feature_names': None,
}
#get_input_variables(input_variables)
input_variables['task.dataframe_id_test'] = variables.get("task.dataframe_id_test")
input_variables['task.label_column'] = variables.get("task.label_column")
input_variables['task.feature_names'] = variables.get("task.feature_names")

resultMetadata.put("task.dataframe_id_test", input_variables['task.dataframe_id_test'])
resultMetadata.put("task.label_column", input_variables['task.label_column'])
resultMetadata.put("task.feature_names", input_variables['task.feature_names'])

print("Loop block start ", str(variables.get('PA_TASK_ITERATION')))
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="start"></controlFlow>
      <metadata>
        <positionTop>
            739.96875
        </positionTop>
        <positionLeft>
            216.5
        </positionLeft>
      </metadata>
    </task>
    <task name="Loop" 
    
    
    
    
    fork="true">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_loop.png"/>
      </genericInformation>
      <depends>
        <task ref="Wait_for_Signal"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="javascript">
            <![CDATA[
variables.remove("PA_TASK_ITERATION_SIGNAL")
print('Loop block end ' + variables.get('PA_TASK_ITERATION'))
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow  block="end">
        <loop target="Start">
          <script>
            <code language="groovy">
              <![CDATA[
if("Make_New_Prediction".equalsIgnoreCase(variables.get('RECEIVED_SIGNAL'))) {
    loop = true;
} else {
    loop = false;
}
]]>
            </code>
          </script>
        </loop>
      </controlFlow>
      <metadata>
        <positionTop>
            1123.96875
        </positionTop>
        <positionLeft>
            216.5
        </positionLeft>
      </metadata>
    </task>
    <task name="Get_Parameters" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ The simplest task, ran by a Python engine. ]]>
      </description>
      <depends>
        <task ref="Split_Data"/>
        <task ref="MaaS_ML_Deploy_Model"/>
      </depends>
      <forkEnvironment javaHome="/usr" >
        <envScript>
          <script>
            <file url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_ai/raw" language="groovy"></file>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <code language="cpython">
            <![CDATA[
import urllib.request
import ssl
import pandas as pd

global variables

# -------------------------------------------------------------
# Get schedulerapi access and acquire session id
schedulerapi.connect()
sessionid = schedulerapi.getSession()

# -------------------------------------------------------------
# Import an external python script containing a collection of
# common utility Python functions and classes

SERVICE_TOKEN = variables.get("SERVICE_TOKEN")
PA_CATALOG_REST_URL = variables.get("PA_CATALOG_REST_URL")
PA_PYTHON_UTILS_URL = PA_CATALOG_REST_URL + "/buckets/machine-learning/resources/Utils_Script/raw"
req = urllib.request.Request(PA_PYTHON_UTILS_URL)
req.add_header('sessionid', sessionid)
if PA_PYTHON_UTILS_URL.startswith('https'):
    content = urllib.request.urlopen(req, context=ssl._create_unverified_context()).read()
else:
    content = urllib.request.urlopen(req).read()
exec(content, globals())

global get_input_variables
global raiser_ex
# -------------------------------------------------------------

input_variables = {
    'task.dataframe_id_test': None,
    'task.dataframe_id': None,
    'task.label_column': None,
    'task.feature_names': None,
}
get_input_variables(input_variables)

#resultMetadata.put("task.dataframe_id_test", input_variables['task.dataframe_id_test'])
#resultMetadata.put("task.label_column", input_variables['task.label_column'])
#resultMetadata.put("task.feature_names", input_variables['task.feature_names'])

variables.put("task.dataframe_id_test",input_variables['task.dataframe_id_test'])
variables.put("task.label_column",input_variables['task.label_column'])
variables.put("task.feature_names",input_variables['task.feature_names'])

variables.put("SERVICE_TOKEN", SERVICE_TOKEN)
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            611.96875
        </positionTop>
        <positionLeft>
            216.5
        </positionLeft>
      </metadata>
    </task>
  </taskFlow>
  <metadata>
    <visualization>
      <![CDATA[ <html>
    <head>
    <link rel="stylesheet" href="/studio/styles/studio-standalone.css">
        <style>
        #workflow-designer {
            left:0 !important;
            top:0 !important;
            width:2030px;
            height:2560px;
            }
        </style>
    </head>
    <body>
    <div id="workflow-visualization-view"><div id="workflow-visualization" style="position:relative;top:-94.96875px;left:-113px"><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1" style="top: 227.969px; left: 216.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Separate data into training and testing sets."><img src="/automation-dashboard/styles/patterns/img/wf-icons/data-processing.png" width="20px">&nbsp;<span class="name">Split_Data</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_4" style="top: 355.969px; left: 118px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Train a classification/clustering/anomaly detection model"><img src="/automation-dashboard/styles/patterns/img/wf-icons/train.png" width="20px">&nbsp;<span class="name">Train_Model</span></a></div><div class="task _jsPlumb_endpoint_anchor_ ui-draggable" id="jsPlumb_1_7" style="top: 227.969px; left: 384px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Support Vector Machines are supervised learning models with associated learning algorithms that analyze data used for classification."><img src="/automation-dashboard/styles/patterns/img/wf-icons/ml_classification.png" width="20px">&nbsp;<span class="name">Support_Vector_Machines</span></a></div><div class="task _jsPlumb_endpoint_anchor_ ui-draggable" id="jsPlumb_1_10" style="top: 99.9688px; left: 216.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Load and return the iris dataset classification."><img src="/automation-dashboard/styles/patterns/img/wf-icons/load_dataset.png" width="20px">&nbsp;<span class="name">Load_Iris_Dataset</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_13" style="top: 1251.97px; left: 216.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Manage the life-cycle of MaaS_ML PSA. This workflow trigger three possible actions: Pause_MaaS_ML, Resume_MaaS_ML and Finish_MaaS_ML."><img src="/automation-dashboard/styles/patterns/img/wf-icons/model_as_service.png" width="20px">&nbsp;<span class="name">MaaS_ML_Actions</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_ active-task" id="jsPlumb_1_16" style="top: 995.969px; left: 216.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="A template task that sends a ready notification for all the signals specified in the variable SIGNALS, then loops until one signal among those specified is received by the job."><img src="/automation-dashboard/styles/patterns/img/wf-icons/signal-wait.png" width="20px">&nbsp;<span class="name">Wait_for_Signal</span></a></div><div class="task _jsPlumb_endpoint_anchor_ ui-draggable" id="jsPlumb_1_19" style="top: 355.969px; left: 246px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Start a model server to deploy ML models."><img src="/automation-dashboard/styles/patterns/img/wf-icons/model_as_service.png" width="20px">&nbsp;<span class="name">MaaS_ML_Service_Start</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_22" style="top: 483.969px; left: 182px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Deploy a ML model."><img src="/automation-dashboard/styles/patterns/img/wf-icons/model_as_service.png" width="20px">&nbsp;<span class="name">MaaS_ML_Deploy_Model</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_25" style="top: 867.969px; left: 216.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Call the launched service to predict results based on the last deployed model."><img src="/automation-dashboard/styles/patterns/img/wf-icons/model_as_service.png" width="20px">&nbsp;<span class="name">MaaS_ML_Call_Prediction</span></a></div><div class="task block-start ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_28" style="top: 739.969px; left: 216.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_loop.png" width="20px">&nbsp;<span class="name">Start</span></a></div><div class="task block-end ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_31" style="top: 1123.97px; left: 216.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_loop.png" width="20px">&nbsp;<span class="name">Loop</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_34" style="top: 611.969px; left: 216.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="The simplest task, ran by a Python engine."><img src="/studio/images/Python.png" width="20px">&nbsp;<span class="name">Get_Parameters</span></a></div><svg style="position:absolute;left:256.5px;top:139.5px" width="28.5" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 17.5 50 7.5 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.1923999999999997,66.303232 L7.334892955184595,47.37624890849568 L-0.382160168186493,52.42075989481225 L-6.5475791500031475,45.56600907668218 L-2.1923999999999997,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.1923999999999997,66.303232 L7.334892955184595,47.37624890849568 L-0.382160168186493,52.42075989481225 L-6.5475791500031475,45.56600907668218 L-2.1923999999999997,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:157.5px;top:267.5px" width="120" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 109 50 99 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M10.433213999999998,61.830692 L31.034253057193034,56.87113660016756 L22.197700652183677,54.24143289185301 L23.444993949046044,45.10664994798388 L10.433213999999998,61.830692" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M10.433213999999998,61.830692 L31.034253057193034,56.87113660016756 L22.197700652183677,54.24143289185301 L23.444993949046044,45.10664994798388 L10.433213999999998,61.830692" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:157.5px;top:267.5px" width="313" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 302 50 292 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M49.645548000000005,58.618708 L70.6415760849262,61.47647017642244 L63.36258264825999,55.81817939660471 L67.84104748153091,47.759435528162456 L49.645548000000005,58.618708" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M49.645548000000005,58.618708 L70.6415760849262,61.47647017642244 L63.36258264825999,55.81817939660471 L67.84104748153091,47.759435528162456 L49.645548000000005,58.618708" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:256.5px;top:1163.5px" width="30" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 9 88 C 19 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M11.064096,66.303232 L15.016942635045325,45.485571144855605 L8.985401777301874,52.45841237934327 L1.1721230143885997,47.56426536755374 L11.064096,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M11.064096,66.303232 L15.016942635045325,45.485571144855605 L8.985401777301874,52.45841237934327 L1.1721230143885997,47.56426536755374 L11.064096,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:259px;top:907.5px" width="45" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 88 C -10 38 34 50 24 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-0.6893655000000017,65.8307285 L12.602253434580478,49.32821759717369 L3.9975102977851975,52.63856433879676 L-0.5899107266227688,44.641341799388485 L-0.6893655000000017,65.8307285" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-0.6893655000000017,65.8307285 L12.602253434580478,49.32821759717369 L3.9975102977851975,52.63856433879676 L-0.5899107266227688,44.641341799388485 L-0.6893655000000017,65.8307285" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:302.0266769263776px;top:945.5px" width="20.473323073622403" height="141" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 40 C -10 90 -10 -50 0 0 " transform="translate(19.973323073622403,50.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#316b31" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.4569999999999963,49.16001999999999 L-8.714346841294152,28.91537600442066 L-10.77778447022079,37.90104376767174 L-19.973323073622403,37.23616047464146 L-2.4569999999999963,49.16001999999999" class="" stroke="#316b31" fill="#316b31" transform="translate(19.973323073622403,50.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.4569999999999963,49.16001999999999 L-8.714346841294152,28.91537600442066 L-10.77778447022079,37.90104376767174 L-19.973323073622403,37.23616047464146 L-2.4569999999999963,49.16001999999999" class="" stroke="#316b31" fill="#316b31" transform="translate(19.973323073622403,50.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_55" style="position: absolute; transform: translate(-50%, -50%); left: 314px; top: 1015.5px;">loop</div><svg style="position:absolute;left:246.5px;top:395.5px" width="83" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 72 50 62 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M3.8637169999999985,63.998374500000004 L22.563757325458827,54.03300988919857 L13.35014363534506,53.70236995006823 L12.267752775527054,44.54658325385351 L3.8637169999999985,63.998374500000004" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M3.8637169999999985,63.998374500000004 L22.563757325458827,54.03300988919857 L13.35014363534506,53.70236995006823 L12.267752775527054,44.54658325385351 L3.8637169999999985,63.998374500000004" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:157.5px;top:395.5px" width="110" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 89 88 C 99 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M80.38784375,62.2538125 L68.29767524802567,44.8518635978262 L69.05011953404043,54.04065174406419 L60.084514492089866,56.18958781378577 L80.38784375,62.2538125" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M80.38784375,62.2538125 L68.29767524802567,44.8518635978262 L69.05011953404043,54.04065174406419 L60.084514492089866,56.18958781378577 L80.38784375,62.2538125" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:256.5px;top:779.5px" width="47.5" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 26.5 88 C 36.5 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M26.964336125000003,65.8307285 L26.243888495536428,44.653359560181244 L21.892827233347354,52.7815983542053 L13.194758349741722,49.7248684518339 L26.964336125000003,65.8307285" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M26.964336125000003,65.8307285 L26.243888495536428,44.653359560181244 L21.892827233347354,52.7815983542053 L13.194758349741722,49.7248684518339 L26.964336125000003,65.8307285" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:256.5px;top:651.5px" width="25" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 14 50 4 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.4906875000000004,66.78168750000002 L6.088432834392776,47.40647926142854 L-1.3695665952116438,52.82664941632405 L-7.866605249283188,46.28535835664018 L-2.4906875000000004,66.78168750000002" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.4906875000000004,66.78168750000002 L6.088432834392776,47.40647926142854 L-1.3695665952116438,52.82664941632405 L-7.866605249283188,46.28535835664018 L-2.4906875000000004,66.78168750000002" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:256.5px;top:1035.5px" width="23.5" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 88 C -10 38 12.5 50 2.5 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.612421875,66.78168750000002 L5.589799912231152,47.243940502122534 L-1.7618140918536094,52.80755187738454 L-8.384335710384322,46.39333271897615 L-2.612421875,66.78168750000002" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.612421875,66.78168750000002 L5.589799912231152,47.243940502122534 L-1.7618140918536094,52.80755187738454 L-8.384335710384322,46.39333271897615 L-2.612421875,66.78168750000002" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:303.4247705270573px;top:779.5px" width="14.075229472942693" height="345" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 0 C -10 50 -10 294 0 344 " transform="translate(13.575229472942693,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#316b31" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-5.913,75.29079600000001 L0.41700350870016756,95.51283980323225 L-6.379279087484884,89.28302898164287 L-13.575229472942693,95.04656071574738 L-5.913,75.29079600000001" class="" stroke="#316b31" fill="#316b31" transform="translate(13.575229472942693,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-5.913,75.29079600000001 L0.41700350870016756,95.51283980323225 L-6.379279087484884,89.28302898164287 L-13.575229472942693,95.04656071574738 L-5.913,75.29079600000001" class="" stroke="#316b31" fill="#316b31" transform="translate(13.575229472942693,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_74" style="position: absolute; transform: translate(-50%, -50%); left: 309px; top: 951.5px;">loop</div><svg style="position:absolute;left:256.5px;top:267.5px" width="25" height="345" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 4 344 C 14 294 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M6.002643999999999,268.709204 L12.402810917078156,248.50925688537768 L5.584942261801553,254.71543662813383 L-1.5909564547880048,248.92695862357613 L6.002643999999999,268.709204" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M6.002643999999999,268.709204 L12.402810917078156,248.50925688537768 L5.584942261801553,254.71543662813383 L-1.5909564547880048,248.92695862357613 L6.002643999999999,268.709204" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:246.5px;top:523.5px" width="35" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 14 88 C 24 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M15.636416,66.303232 L18.256834191833065,45.2762634001302 L12.681124621216075,52.61870596266551 L4.57230815449858,48.23155477891412 L15.636416,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M15.636416,66.303232 L18.256834191833065,45.2762634001302 L12.681124621216075,52.61870596266551 L4.57230815449858,48.23155477891412 L15.636416,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 257px; top: 258px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 257px; top: 218px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 158px; top: 386px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 158px; top: 346px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 450px; top: 258px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 264.5px; top: 130px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 266px; top: 1282px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 266px; top: 1242px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 259.5px; top: 1026px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 259.5px; top: 986px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint loop-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 312px; top: 986px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#316b31" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint loop-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 312px; top: 1026px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#316b31" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 309px; top: 386px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 247px; top: 514px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 247px; top: 474px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 283.5px; top: 898px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 283.5px; top: 858px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 257px; top: 770px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 257px; top: 730px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint loop-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 307px; top: 770px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#316b31" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 257px; top: 1154px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 257px; top: 1114px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint loop-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 307px; top: 1114px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#316b31" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 261px; top: 642px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 261px; top: 602px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div></div></div>
    </body>
</html>
 ]]>
    </visualization>
  </metadata>
</job>